#!/bin/bash

# let 1 = HeadScript
# let 2 = Flavor
# for each directory in Flavor[.../target?]: directory = module, jsfiles = module[units]
# result: HeadScript.module.unit/module++

# sample: build jCafe from the root directory: bin/build jCafe.js library

compileOptions="";

while [[ ${1:0:2} == -- ]]; do

  if [[ ${1} == --port ]]; then
    [[ "$2" =~ \:$ ]] || {
      echo invalid arguments expected new.root: current.root
      exit 1;
    } >&2;
    compileOptions+="$1 $2 $3 ";
    shift 3;
    continue;
  fi;

  echo "Sorry, i don't know what $1 means" >&2;
  exit 1;
  
done;

localHost=${0%/build};

$localHost/jscompile $compileOptions `(echo "$1"; $localHost/treecat "$2") | $localHost/jsfilter`

